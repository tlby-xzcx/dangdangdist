"use strict";define(["jquery"],function(){return{init:function(){c();var n=oCookie.get("cookiesid").split(","),a=oCookie.get("cookienum").split(",");$.each(n,function(t,i){var o,e;o=n[t],e=a[t],$.ajax({url:"http://localhost/dangdang/src/php/dshoppingcar.php",dataType:"json"}).done(function(t){$.each(t,function(t,i){if(o==i.id){var n=$("tbody tr:hidden").clone(!0,!0);n.find(".row2 a img").attr({src:i.img,sid:i.id}),n.find(".big_img img").attr("src",i.img),n.find(".name a").attr("title",i.title),n.find(".name a").html(i.title),n.find(".sig").html(i.price),n.find(".amount input").val(e),n.find("#price").html((parseFloat(i.price)*e).toFixed(2)),n.css("display","block"),$("tbody").append(n)}}),r()})}),$(".li1 input").on("change",function(){$("tbody tr:visible .row1 input").prop("checked",$(this).prop("checked")),$(".shopping_totalleft input").prop("checked",$(this).prop("checked")),r()}),$(".shopping_totalleft input").on("change",function(){$("tbody tr:visible .row1 input").prop("checked",$(this).prop("checked")),$(".li1 input").prop("checked",$(this).prop("checked")),r()});var t=$("tbody tr:visible .row1 input");function r(){c();var n=0,o=0;$("tbody tr:visible").each(function(t,i){$(i).find(".row1 input").prop("checked")&&(n+=parseInt($(i).find(".amount input").val()),o+=parseFloat($(i).find("#price").html())),$(".shopping_totalleft b").html(n),$("#payAmount span").html(o.toFixed(2)),0!=$("#payAmount span").html()?$(".total_btn").removeClass("unable"):$(".total_btn").addClass("unable")})}function o(t){return(parseFloat(t.parents("tbody tr").find(".row4 .sig").html())*parseInt(t.parents("tbody tr").find(".row5 .amount input").val())).toFixed(2)}$("table").on("click",t,function(){$("tbody tr:visible").find(":checkbox").length===$("tbody tr:visible").find(":checked").length?($(".li1 input").prop("checked",!0),$(".shopping_totalleft input").prop("checked",!0)):($(".li1 input").prop("checked",!1),$(".shopping_totalleft input").prop("checked",!1)),r()}),$("#add").on("click",function(){$(this).parents("tbody tr").find(".row7 .tanchukuang").hide();var t=parseInt($(this).parents("tbody tr").find(".row5 .amount input").val());t++,$(this).parents("tbody tr").find(".row5 .amount input").val(t),$(this).parents("tbody tr").find("#price").html(o($(this))),r(),d($(this))}),$("#del").on("click",function(){var t=this,i=parseInt($(this).parents("tbody tr").find(".row5 .amount input").val());--i<1&&(i=1,$(this).parents("tbody tr").find(".row7 .tanchukuang").show(),$(".org_btnb").on("click",function(){r(),$(t).parents("tr").remove(),s($(t).parents("tr").find(".row2 a img").attr("sid"),e),$(t).parents("tbody tr").find(".row7 .tanchukuang").hide()})),$(this).parents("tbody tr").find(".row5 .amount input").val(i),$(this).parents("tbody tr").find("#price").html(o($(this))),r(),d($(this))}),$(".amount input").on("input",function(){var t=$(this).parents("tbody tr").find(".row5 .amount input").val();/^\d+$/g.test(t)||$(this).val(1),$(this).parents("tbody tr").find("#price").html(o($(this))),r(),d($(this))}),$("#delete").on("click",function(){var t=this;$(this).parents(".row7").find(".tanchukuang").show(),$(".org_btnb").on("click",function(){r(),$(t).parents("tr").remove(),s($(t).parents("tr").find(".row2 a img").attr("sid"),e),$(t).parents(".row7").find(".tanchukuang").hide()})}),$(".promo_btn").on("click",function(){$(".tanchukuang").hide()}),$(".moredel").on("click",function(){c(),$(".shopping_totalleft .tanchukuang").show(),$(".shopping_totalleft .org_btnb").on("click",function(){c(),$("tbody tr:visible").each(function(){$(this).find(":checkbox").is(":checked")&&($(this).remove(),s($(this).find(".row2 a img").attr("sid"),e),c(),r())}),r(),$(".shopping_totalleft .tanchukuang").hide()})});var e=[],p=[];function c(){oCookie.get("cookiesid")&&oCookie.get("cookienum")?(e=oCookie.get("cookiesid").split(","),p=oCookie.get("cookienum").split(",")):(e=[],p=[],$(".shopping_totalleft b").html("0"),$("#payAmount span").html("0"),$(".total_btn").removeClass("unable"))}function d(t){c();var i=t.parents("tbody tr").find(".row2 img").attr("sid");p[$.inArray(i,e)]=t.parents("tbody tr").find(".row5 input").val(),oCookie.add("cookienum",p,100)}function s(n,t){c();var o=void 0;$.each(t,function(t,i){n===i&&(o=t)}),t.splice(o,1),p.splice(o,1),oCookie.add("cookiesid",t,100),oCookie.add("cookienum",p,100)}c()}}});